# ğŸ—„ï¸ Database Backup Utility 

## ğŸ“– Overview
Database Backup Utility Database Backup Utility Project - https://roadmap.sh/projects/database-backup-utility

The **Database Backup Utility** is a command-line application built with **Spring Shell** that provides an easy way to back up, compress, restore, and schedule database backups.  
It uses **Quartz Scheduler** for job scheduling and supports **file compression** and **cloud storage integration** (AWS, Azure, GCP).

> ğŸ¯ The goal is to simplify database maintenance through an extensible, scriptable, and interactive CLI tool.

---

## âš™ï¸ Key Features

- ğŸ§° **Interactive CLI with Spring Shell** â€” Run commands directly to connect, back up, restore, and manage backups.  
- â° **Quartz Scheduler Integration** â€” Automate backups using cron expressions.  
- ğŸ—œï¸ **File Compression Support** â€” Supports `ZIP`, `GZIP`, and `TAR.GZ` formats.  
- â˜ï¸ **Cloud Storage Integration** â€” Upload/download backups from AWS S3, Azure Blob, and GCP Cloud Storage.  
- ğŸ§© **Extensible Architecture** â€” Easily extend support for new databases or storage providers.  

---

## ğŸ§  Architecture Overview

![Architecture Diagram](/flowchart_database_backup_utility.png?raw=true "Database Backup Utility")

---

## ğŸ’» Technologies Used

| Component | Purpose |
|------------|----------|
| **Spring Shell** | Provides the interactive command-line interface |
| **Quartz Scheduler** | Handles job scheduling and cron-based automation |
| **Java NIO / ProcessBuilder** | Executes database dump commands and file I/O |
| **SLF4J + Logback** | Logging |
| **Lombok** | Reduces boilerplate code |
| **Jakarta Validation** | Input validation for CLI options |
| **AWS / Azure / GCP SDKs** | Cloud storage integration |

---

## ğŸ“‚ Project Structure

```bash
database-backup-utility/
 â”œâ”€â”€ .env                                 # ğŸŒ± Environment variables file (Spring Boot auto-loaded) 
 â”œâ”€â”€ pom.xml                              # Maven build configuration
 â”œâ”€â”€ README.md                            # Project documentation
 â”œâ”€â”€ .gitignore                           # Git ignore rules
 â”‚
 â”œâ”€â”€ src/
 â”‚   â”œâ”€â”€ main/java/dbu/                   # Main application source
 â”‚   â”‚   â”œâ”€â”€ commands/                    # ğŸ§­ CLI Commands
 â”‚   â”‚   â”œâ”€â”€ services/                    # âš™ï¸ Business logic (backup, restore, scheduler, storage)
 â”‚   â”‚   â”œâ”€â”€ models/                      # ğŸ§± DTOs and configuration classes
 â”‚   â”‚   â”œâ”€â”€ enums/                       # ğŸ§© Enums (DatabaseType, CompressType, StorageType)
 â”‚   â”‚   â”œâ”€â”€ exceptions/                  # âš ï¸ Custom exceptions
 â”‚   â”‚   â””â”€â”€ utils/                       # ğŸ”§ Utility classes
 â”‚   â”‚
 â”‚   â”œâ”€â”€ resources/
 â”‚   â”‚   â”œâ”€â”€ application.yml              # Spring Boot configuration (imports .env)
 â”‚   â”‚   â”œâ”€â”€ banner.txt                   # ASCII startup banner
 â”‚   â”‚   â””â”€â”€ quartz_tables.sql            # SQL schema for Quartz (if using JDBC store)
 â”‚   â”‚
 â”‚   â””â”€â”€ test/                            # ğŸ§ª Unit & Integration Tests
 â”‚       â”œâ”€â”€ backup/
 â”‚       â”œâ”€â”€ connect/
 â”‚       â””â”€â”€ restore/
 â”‚
 â””â”€â”€ target/                              # âš™ï¸ Build output (generated by Maven)
```

---

## ğŸš€ Getting Started

### 1ï¸âƒ£ Prerequisites

- Java **17** or higher  
- **Maven** or **Gradle**  
- Installed database tools (`pg_dump`, `mysqldump`, `mongodump`)  
- Network access to your database and cloud provider  

---

### 2ï¸âƒ£ Installation

#### Clone and build the project:

```bash
git clone https://github.com/yourusername/database-backup-utility.git
cd database-backup-utility
mvn clean package
```
#### Config the project:

You can select either of the two options:

Create your own `.env` file (Option 1):

Run this command in the root directory of the `database-backup-utility` project to create an empty `.env` file.

```bash
touch .env 
```

Then open the .env file with your preferred text editor (e.g., vim, nano, code, etc.) and replace the placeholder values with your actual configuration.

```properties
#This is example .env file
#Note: Please place the .env file in the root directory of the database-backup-utility project. 
DB_HOST=your_db_host
DB_PORT=your_db_port
DB_NAME=your_db_name
DB_USER=your_db_user
DB_PASS=your_db_password

AWS_ACCESS_KEY=your_aws_access_key
AWS_SECRET_KEY=your_aws_secret_key
AWS_BUCKET_NAME=your-aws-bucket-name
AWS_REGION=your-aws-bucket-region

AZURE_CONNECTION_STRING=your_azure_connection_string
AZURE_CONTAINER_NAME=your-azure-container-name

GCP_CREDENTIALS_PATH=your-credentials-path #e.g. /home/user/gcp-credentials.json
GCP_BUCKET_NAME=your-gcp-bucket-name
```

Export environment variable (Option 2):
```bash
export DB_HOST=your_db_host
export DB_PORT=your_db_port
export DB_NAME=your_db_name
export DB_USER=your_db_user
export DB_PASS=your_db_password

export AWS_ACCESS_KEY=your_aws_access_key
export AWS_SECRET_KEY=your_aws_secret_key
export AWS_BUCKET_NAME=your-aws-bucket-name
export AWS_REGION=your-aws-bucket-region

export AZURE_CONNECTION_STRING=your_azure_connection_string
export AZURE_CONTAINER_NAME=your-azure-container-name

export GCP_CREDENTIALS_PATH=your-credentials-path #e.g. /home/user/gcp-credentials.json
export GCP_BUCKET_NAME=your-gcp-bucket-name
```

#### Run the CLI:

```bash
java -jar target/database-backup-utility.jar
```

---

## ğŸ’¬ Spring Shell CLI

When the app starts, youâ€™ll see a prompt like this:

```
shell:>_
```

Type `help` to view all available commands.

---

## ğŸ§­ Usage Guide

### âš™ï¸ 1. Connect to a Database

```bash
connect --database-type <TYPE> --host <HOST> --port <PORT> --database <DB_NAME> --user <USER> --password <PASSWORD>
```

**Example:**
```bash
shell:> connect --database-type MYSQL --host localhost --port 3306 --database sales --user root --password pass123
```
âœ… Output:
```
Successfully connected to database: sales [MYSQL] 
```

---

### ğŸ’¾ 2. Backup a Database

```bash
backup --database-type <TYPE> --host <HOST> --port <PORT> --database <DB_NAME> --user <USER> --password <PASSWORD> --output <OUTPUT_PATH> --compress <TYPE> --cron <CRON_EXPRESSION>
```

**Example 1: Immediate Backup**
```bash
shell:> backup --database-type POSTGRESQL --database mydb --user admin --password pass123 --output ./backups --compress GZIP
```
âœ… Output:
```
Database backup completed successfully: ./backups/backup_mydb_2025-10-23.gzip
```

**Example 2: Scheduled Backup**
```bash
shell:> backup --database-type MYSQL --database sales --user root --password 12345 --output ./backups --compress ZIP --cron "0 0 3 * * ?"
```
âœ… Output:
```
Backup schedule created successfully. The database will be backed up according to the cron schedule: 0 0 3 * * ?
```

---

### ğŸ” 3. Restore a Database

```bash
restore --database-type <TYPE> --database <DB_NAME> --user <USER> --password <PASSWORD> --input-path <BACKUP_FILE_PATH>
```

**Example:**
```bash
shell:> restore --database-type POSTGRESQL --database mydb --user admin --password pass123 --input-path ./backups/backup_mydb_2025-10-22.zip
```
âœ… Output:
```
Database restore successful.
```

---

### â˜ï¸ 4. Cloud Storage Commands

**Upload a Backup File**
```bash
upload --storage-type <TYPE> --key <REMOTE_PATH> --file-path <LOCAL_FILE>
```

**Example:**
```bash
shell:> upload --storage-type AWS --key backups/mydb_2025-10-23.gzip --file-path ./backups/backup_mydb_2025-10-23.gzip
```
âœ… Output:
```
Upload successful! URL: https://s3.amazonaws.com/mybucket/backups/mydb_2025-10-23.gzip
```

**Download a File**
```bash
download --storage-type <TYPE> --key <REMOTE_PATH> --destination <LOCAL_DIR>
```

**Example:**
```bash
shell:> download --storage-type GCP --key backups/sales_2025-10-20.zip --destination ./downloads
```
âœ… Output:
```
Download successful! Saved to: ./downloads/sales_2025-10-20.zip
```

**Delete a File**
```bash
delete --storage-type <TYPE> --key <REMOTE_PATH>
```

**Example:**
```bash
shell:> delete --storage-type GCP --key backups/sales_2025-10-20.zip 
```
âœ… Output:
```
File deleted successfully.
```

**List All Files**
```bash
list --storage-type <TYPE>
```

**Example:**
```bash
shell:> list --storage-type GCP 
```
âœ… Output:
```
Files in storage:
backups/sales_2025-10-20.zip
backups/sales_2025-10-22.zip
backups/sales_2025-10-24.zip
```

**Check if a File Exists**
```bash
check --storage-type <TYPE> --key <REMOTE_PATH>
```

**Example:**
```bash
shell:> check --storage-type AWS --key backups/mydb_2025-10-23.gzip
```
âœ… Output:
```
File exists: true
```

---

## ğŸ§© Example Workflow

```bash
# 1. Connect
shell:> connect --database-type POSTGRESQL --database mydb --user admin --password 1234

# 2. Backup & Compress
shell:> backup --database-type POSTGRESQL --database mydb --user admin --password 1234 --output ./backups --compress ZIP

# 3. Upload to S3
shell:> upload --storage-type AWS --key backups/mydb_latest.zip --file-path ./backups/backup_mydb_latest.zip

# 4. Schedule daily backups at 2 AM
shell:> backup --database-type POSTGRESQL --database mydb --user admin --password 1234 --output ./backups --cron "0 0 2 * * ?"
```

---

## ğŸ—œï¸ Compression Options

| Type | Extension | Description |
|-------|------------|-------------|
| **NONE** | (no compression) | Raw dump file |
| **ZIP** | `.zip` | Standard compression |
| **GZIP** | `.gzip` | Fast single-file compression |
| **TAR.GZ** | `.tar.gz` | Common on Linux/Unix |

---

## ğŸ§± Scheduling with Quartz

Automate periodic backups using cron expressions.  
Example:
```bash
shell:> backup --database-type POSTGRESQL --database mydb --user admin --password pass123 --output ./backups --cron "0 0 3 * * ?"
```
âœ… Backup schedule created successfully. The database will be backed up according to the cron schedule: **0 0 3 * * ?**.

---
