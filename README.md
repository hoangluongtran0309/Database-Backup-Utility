# 🗄️ Database Backup Utility 

## 📖 Overview
Database Backup Utility Database Backup Utility Project - https://roadmap.sh/projects/database-backup-utility

The **Database Backup Utility** is a command-line application built with **Spring Shell** that provides an easy way to back up, compress, restore, and schedule database backups.  
It uses **Quartz Scheduler** for job scheduling and supports **file compression** and **cloud storage integration** (AWS, Azure, GCP).

> 🎯 The goal is to simplify database maintenance through an extensible, scriptable, and interactive CLI tool.

---

## ⚙️ Key Features

- 🧰 **Interactive CLI with Spring Shell** — Run commands directly to connect, back up, restore, and manage backups.  
- ⏰ **Quartz Scheduler Integration** — Automate backups using cron expressions.  
- 🗜️ **File Compression Support** — Supports `ZIP`, `GZIP`, and `TAR.GZ` formats.  
- ☁️ **Cloud Storage Integration** — Upload/download backups from AWS S3, Azure Blob, and GCP Cloud Storage.  
- 🧩 **Extensible Architecture** — Easily extend support for new databases or storage providers.  

---

## 🧠 Architecture Overview

![Architecture Diagram](/flowchart_database_backup_utility.png?raw=true "Database Backup Utility")

---

## 💻 Technologies Used

| Component | Purpose |
|------------|----------|
| **Spring Shell** | Provides the interactive command-line interface |
| **Quartz Scheduler** | Handles job scheduling and cron-based automation |
| **Java NIO / ProcessBuilder** | Executes database dump commands and file I/O |
| **SLF4J + Logback** | Logging |
| **Lombok** | Reduces boilerplate code |
| **Jakarta Validation** | Input validation for CLI options |
| **AWS / Azure / GCP SDKs** | Cloud storage integration |

---

## 📂 Project Structure

```bash
database-backup-utility/
 ├── .env                                 # 🌱 Environment variables file (Spring Boot auto-loaded) 
 ├── pom.xml                              # Maven build configuration
 ├── README.md                            # Project documentation
 ├── .gitignore                           # Git ignore rules
 │
 ├── src/
 │   ├── main/java/dbu/                   # Main application source
 │   │   ├── commands/                    # 🧭 CLI Commands
 │   │   ├── services/                    # ⚙️ Business logic (backup, restore, scheduler, storage)
 │   │   ├── models/                      # 🧱 DTOs and configuration classes
 │   │   ├── enums/                       # 🧩 Enums (DatabaseType, CompressType, StorageType)
 │   │   ├── exceptions/                  # ⚠️ Custom exceptions
 │   │   └── utils/                       # 🔧 Utility classes
 │   │
 │   ├── resources/
 │   │   ├── application.yml              # Spring Boot configuration (imports .env)
 │   │   ├── banner.txt                   # ASCII startup banner
 │   │   └── quartz_tables.sql            # SQL schema for Quartz (if using JDBC store)
 │   │
 │   └── test/                            # 🧪 Unit & Integration Tests
 │       ├── backup/
 │       ├── connect/
 │       └── restore/
 │
 └── target/                              # ⚙️ Build output (generated by Maven)
```

---

## 🚀 Getting Started

### 1️⃣ Prerequisites

- Java **17** or higher  
- **Maven** or **Gradle**  
- Installed database tools (`pg_dump`, `mysqldump`, `mongodump`)  
- Network access to your database and cloud provider  

---

### 2️⃣ Installation

Clone and build the project:

```bash
git clone https://github.com/yourusername/database-backup-utility.git
cd database-backup-utility
mvn clean package
```

### 3️⃣ Configuration

You can select either of the two options:

Create your own `.env` file (Option 1):

Run this command in the root directory of the `database-backup-utility` project to create an empty `.env` file.

```bash
touch .env 
```

Then open the .env file with your preferred text editor (e.g., vim, nano, code, etc.) and replace the placeholder values with your actual configuration.

```properties
#This is example .env file
#Note: Please place the .env file in the root directory of the database-backup-utility project. 
DB_HOST=your_db_host
DB_PORT=your_db_port
DB_NAME=your_db_name
DB_USER=your_db_user
DB_PASS=your_db_password

AWS_ACCESS_KEY=your_aws_access_key
AWS_SECRET_KEY=your_aws_secret_key
AWS_BUCKET_NAME=your-aws-bucket-name
AWS_REGION=your-aws-bucket-region

AZURE_CONNECTION_STRING=your_azure_connection_string
AZURE_CONTAINER_NAME=your-azure-container-name

GCP_CREDENTIALS_PATH=your-credentials-path #e.g. /home/user/gcp-credentials.json
GCP_BUCKET_NAME=your-gcp-bucket-name
```

Export environment variable (Option 2):
```bash
export DB_HOST=your_db_host
export DB_PORT=your_db_port
export DB_NAME=your_db_name
export DB_USER=your_db_user
export DB_PASS=your_db_password

export AWS_ACCESS_KEY=your_aws_access_key
export AWS_SECRET_KEY=your_aws_secret_key
export AWS_BUCKET_NAME=your-aws-bucket-name
export AWS_REGION=your-aws-bucket-region

export AZURE_CONNECTION_STRING=your_azure_connection_string
export AZURE_CONTAINER_NAME=your-azure-container-name

export GCP_CREDENTIALS_PATH=your-credentials-path #e.g. /home/user/gcp-credentials.json
export GCP_BUCKET_NAME=your-gcp-bucket-name
```

### 4️⃣ Run the CLI

```bash
java -jar target/database-backup-utility.jar
```

---

## 💬 Spring Shell CLI

When the app starts, you’ll see a prompt like this:

```
dbu:>_
```

Type `help` to view all available commands.

---

## 🧭 Usage Guide

### 🔌 1. Connect to a Database

```bash
connect --database-type <TYPE> --host <HOST> --port <PORT> --database <DB_NAME> --user <USER> --password <PASSWORD>
```

**Example:**
```bash
dbu:> connect --database-type MYSQL --host localhost --port 3306 --database sales --user root --password pass123
```
✅ Output:
```
Successfully connected to database: sales [MYSQL] 
```

---

### 💾 2. Backup a Database

```bash
backup --database-type <TYPE> --host <HOST> --port <PORT> --database <DB_NAME> --user <USER> --password <PASSWORD> --output <OUTPUT_PATH> --compress <TYPE> --cron <CRON_EXPRESSION>
```

**Example 1: ⚡ Immediate Backup**
```bash
dbu:> backup --database-type POSTGRESQL --database mydb --user admin --password pass123 --output ./backups --compress GZIP
```
✅ Output:
```
Database backup completed successfully: ./backups/backup_mydb_2025-10-23.gzip
```

**Example 2: ⏰ Scheduled Backup**
```bash
dbu:> backup --database-type MYSQL --database sales --user root --password 12345 --output ./backups --compress ZIP --cron "0 0 3 * * ?"
```
✅ Output:
```
Backup schedule created successfully. The database will be backed up according to the cron schedule: 0 0 3 * * ?
```

---

### 🔁 3. Restore a Database

```bash
restore --database-type <TYPE> --database <DB_NAME> --user <USER> --password <PASSWORD> --input-path <BACKUP_FILE_PATH>
```

**Example:**
```bash
dbu:> restore --database-type POSTGRESQL --database mydb --user admin --password pass123 --input-path ./backups/backup_mydb_2025-10-22.zip
```
✅ Output:
```
Database restore successful.
```

---

### ☁️ 4. Cloud Storage Commands

**⬆️ Upload a Backup File**
```bash
upload --storage-type <TYPE> --key <REMOTE_PATH> --file-path <LOCAL_FILE>
```

**Example:**
```bash
dbu:> upload --storage-type AWS --key backups/mydb_2025-10-23.gzip --file-path ./backups/backup_mydb_2025-10-23.gzip
```
✅ Output:
```
Upload successful! URL: https://s3.amazonaws.com/mybucket/backups/mydb_2025-10-23.gzip
```

**⬇️ Download a File**
```bash
download --storage-type <TYPE> --key <REMOTE_PATH> --destination <LOCAL_DIR>
```

**Example:**
```bash
dbu:> download --storage-type GCP --key backups/sales_2025-10-20.zip --destination ./downloads
```
✅ Output:
```
Download successful! Saved to: ./downloads/sales_2025-10-20.zip
```

**🗑️ Delete a File**
```bash
delete --storage-type <TYPE> --key <REMOTE_PATH>
```

**Example:**
```bash
dbu:> delete --storage-type GCP --key backups/sales_2025-10-20.zip 
```
✅ Output:
```
File deleted successfully.
```

**📜 List All Files**
```bash
list --storage-type <TYPE>
```

**Example:**
```bash
dbu:> list --storage-type GCP 
```
✅ Output:
```
File Name                                Size           Last Modified       
──────────────────────────────────────────────────────────────────────────────
backups/sales_2025-10-20.zip             15 MB          2025-10-20 16:17:04 
backups/sales_2025-10-22.zip             40 MB          2025-10-22 16:26:36 
backups/sales_2025-10-24.zip             60 MB          2025-10-24 16:26:36 
──────────────────────────────────────────────────────────────────────────────
Total: 3 file(s)
```

**Check if a File Exists**
```bash
check --storage-type <TYPE> --key <REMOTE_PATH>
```

**Example:**
```bash
dbu:> check --storage-type AWS --key backups/mydb_2025-10-23.gzip
```
✅ Output:
```
File exists: true
```

---

## 🧩 Example Workflow

```bash
# 1. Connect
dbu:> connect --database-type POSTGRESQL --database mydb --user admin --password 1234

# 2. Backup & Compress
dbu:> backup --database-type POSTGRESQL --database mydb --user admin --password 1234 --output ./backups --compress ZIP

# 3. Upload to S3
dbu:> upload --storage-type AWS --key backups/mydb_latest.zip --file-path ./backups/backup_mydb_latest.zip

# 4. Schedule daily backups at 2 AM
dbu:> backup --database-type POSTGRESQL --database mydb --user admin --password 1234 --output ./backups --cron "0 0 2 * * ?"
```

---

## 🗜️ Compression Options

| Type | Extension | Description |
|-------|------------|-------------|
| **NONE** | (no compression) | Raw dump file |
| **ZIP** | `.zip` | Standard compression |
| **GZIP** | `.gzip` | Fast single-file compression |
| **TARGZ** | `.tar.gz` | Common on Linux/Unix |

---

## ⏰ Scheduling with Quartz 

Automate periodic backups using cron expressions.  
Example:
```bash
dbu:> backup --database-type POSTGRESQL --database mydb --user admin --password pass123 --output ./backups --cron "0 0 3 * * ?"
```

✅ Output:
```
Backup schedule created successfully. The database will be backed up according to the cron schedule: *0 0 3 * * ?*.
```

---

## 🗓️ Managing Backup Schedulers

After creating backup schedules, you can manage and monitor them directly using the available shell commands provided by `SchedulerCommand`.

### 🔍 View all schedulers
List all existing backup jobs along with their current state, next, and previous execution times.

```bash
dbu:> list-schedulers
```

✅ Output:
```
LIST OF BACKUP JOBS:
================================================================================
JOB NAME                       GROUP        STATE        NEXT FIRE               PREVIOUS FIRE
--------------------------------------------------------------------------------
dailyBackup                    MYSQL        NORMAL       2025-10-28T03:00:00     2025-10-27T03:00:00
================================================================================
```

**📝 Note - Quartz Job States & Groups:**

**Job States**

In Quartz Scheduler, each **Trigger** (and its associated Job) can have one of the following states

- 🟢 NORMAL → Scheduled jobs are running as planned.
- 🟡 PAUSED → Temporarily stopped; can resume later.
- 🔵 COMPLETE → Finished; may need to reschedule for future runs.
- 🔴 ERROR → Check logs to diagnose the failure.
- 🟣 BLOCKED → Job is currently running; concurrent execution is not allowed.

**Job Groups**

Backup jobs are organized into **Groups** according to the type of database:

| Group Name   | Database Type | Description                               |
|-------------|---------------|-------------------------------------------|
| `POSTGRESQL` | PostgreSQL    | Jobs that back up PostgreSQL databases    |
| `MYSQL`      | MySQL         | Jobs that back up MySQL databases         |
| `MONGODB`    | MongoDB       | Jobs that back up MongoDB databases       |

**💡 Tip:**  
- Use **Group names** to filter jobs when pausing, resuming, or deleting specific database backups.  
- Pay attention to **Job States** to understand whether a job is active, paused, completed, or encountering errors.

### ⏸️ Pause a specific scheduler
Temporarily pause a scheduled backup job.
```bash
dbu:> pause-scheduler -j dailyBackup -g BACKUP
```

✅ Output:
```
Paused job: dailyBackup (BACKUP)
```

### ▶️ Resume a paused scheduler
Resume a job that was previously paused.
```bash
dbu:> resume-scheduler -j dailyBackup -g BACKUP
```

✅ Output:
```
Resumed job: dailyBackup (BACKUP)
```

### 🗑️ Delete a scheduler
Completely remove a backup job from the scheduler.
```bash
dbu:> delete-scheduler -j dailyBackup -g BACKUP
```

✅ Output:
```
Deleted job: dailyBackup (BACKUP)
```

### ⏹️ Pause all schedulers
Pause all running backup jobs at once.
```bash
dbu:> pause-all
```

✅ Output:
```
Paused all backup jobs.
```

### 🔁 Resume all schedulers
Resume all paused backup jobs.
```bash
dbu:> resume-all
```

✅ Output:
```
Resumed all backup jobs.
```

 ---

