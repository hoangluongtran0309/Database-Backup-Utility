# ğŸ—„ï¸ Database Backup Utility 

## ğŸ“– Overview
Database Backup Utility Database Backup Utility Project - https://roadmap.sh/projects/database-backup-utility

The **Database Backup Utility** is a command-line application built with **Spring Shell** that provides an easy way to back up, compress, restore, and schedule database backups.  
It uses **Quartz Scheduler** for job scheduling and supports **file compression** and **cloud storage integration** (AWS, Azure, GCP).

> ğŸ¯ The goal is to simplify database maintenance through an extensible, scriptable, and interactive CLI tool.

---

## âš™ï¸ Key Features

- ğŸ§° **Interactive CLI with Spring Shell** â€” Run commands directly to connect, back up, restore, and manage backups.  
- â° **Quartz Scheduler Integration** â€” Automate backups using cron expressions.  
- ğŸ—œï¸ **File Compression Support** â€” Supports `ZIP`, `GZIP`, and `TAR.GZ` formats.  
- â˜ï¸ **Cloud Storage Integration** â€” Upload/download backups from AWS S3, Azure Blob, and GCP Cloud Storage.  
- ğŸ§© **Extensible Architecture** â€” Easily extend support for new databases or storage providers.  

---

## ğŸ§  Architecture Overview

![Architecture Diagram](/flowchart_database_backup_utility.png?raw=true "Database Backup Utility")

---

## ğŸ’» Technologies Used

| Component | Purpose |
|------------|----------|
| **Spring Shell** | Provides the interactive command-line interface |
| **Quartz Scheduler** | Handles job scheduling and cron-based automation |
| **Java NIO / ProcessBuilder** | Executes database dump commands and file I/O |
| **SLF4J + Logback** | Logging |
| **Lombok** | Reduces boilerplate code |
| **Jakarta Validation** | Input validation for CLI options |
| **AWS / Azure / GCP SDKs** | Cloud storage integration |

---

## ğŸ“‚ Project Structure

```bash
database-backup-utility/
 â”œâ”€â”€ .env                                 # ğŸŒ± Environment variables file (Spring Boot auto-loaded) 
 â”œâ”€â”€ pom.xml                              # Maven build configuration
 â”œâ”€â”€ README.md                            # Project documentation
 â”œâ”€â”€ .gitignore                           # Git ignore rules
 â”‚
 â”œâ”€â”€ src/
 â”‚   â”œâ”€â”€ main/java/dbu/                   # Main application source
 â”‚   â”‚   â”œâ”€â”€ commands/                    # ğŸ§­ CLI Commands
 â”‚   â”‚   â”œâ”€â”€ services/                    # âš™ï¸ Business logic (backup, restore, scheduler, storage)
 â”‚   â”‚   â”œâ”€â”€ models/                      # ğŸ§± DTOs and configuration classes
 â”‚   â”‚   â”œâ”€â”€ enums/                       # ğŸ§© Enums (DatabaseType, CompressType, StorageType)
 â”‚   â”‚   â”œâ”€â”€ exceptions/                  # âš ï¸ Custom exceptions
 â”‚   â”‚   â””â”€â”€ utils/                       # ğŸ”§ Utility classes
 â”‚   â”‚
 â”‚   â”œâ”€â”€ resources/
 â”‚   â”‚   â”œâ”€â”€ application.yml              # Spring Boot configuration (imports .env)
 â”‚   â”‚   â”œâ”€â”€ banner.txt                   # ASCII startup banner
 â”‚   â”‚   â””â”€â”€ quartz_tables.sql            # SQL schema for Quartz (if using JDBC store)
 â”‚   â”‚
 â”‚   â””â”€â”€ test/                            # ğŸ§ª Unit & Integration Tests
 â”‚       â”œâ”€â”€ backup/
 â”‚       â”œâ”€â”€ connect/
 â”‚       â””â”€â”€ restore/
 â”‚
 â””â”€â”€ target/                              # âš™ï¸ Build output (generated by Maven)
```

---

## ğŸš€ Getting Started

### 1ï¸âƒ£ Prerequisites

- Java **17** or higher  
- **Maven** or **Gradle**  
- Installed database tools (`pg_dump`, `mysqldump`, `mongodump`)  
- Network access to your database and cloud provider  

---

### 2ï¸âƒ£ Installation

Clone and build the project:

```bash
git clone https://github.com/yourusername/database-backup-utility.git
cd database-backup-utility
mvn clean package
```

### 3ï¸âƒ£ Configuration

You can select either of the two options:

Create your own `.env` file (Option 1):

Run this command in the root directory of the `database-backup-utility` project to create an empty `.env` file.

```bash
touch .env 
```

Then open the .env file with your preferred text editor (e.g., vim, nano, code, etc.) and replace the placeholder values with your actual configuration.

```properties
#This is example .env file
#Note: Please place the .env file in the root directory of the database-backup-utility project. 
DB_HOST=your_db_host
DB_PORT=your_db_port
DB_NAME=your_db_name
DB_USER=your_db_user
DB_PASS=your_db_password

AWS_ACCESS_KEY=your_aws_access_key
AWS_SECRET_KEY=your_aws_secret_key
AWS_BUCKET_NAME=your-aws-bucket-name
AWS_REGION=your-aws-bucket-region

AZURE_CONNECTION_STRING=your_azure_connection_string
AZURE_CONTAINER_NAME=your-azure-container-name

GCP_CREDENTIALS_PATH=your-credentials-path #e.g. /home/user/gcp-credentials.json
GCP_BUCKET_NAME=your-gcp-bucket-name
```

Export environment variable (Option 2):
```bash
export DB_HOST=your_db_host
export DB_PORT=your_db_port
export DB_NAME=your_db_name
export DB_USER=your_db_user
export DB_PASS=your_db_password

export AWS_ACCESS_KEY=your_aws_access_key
export AWS_SECRET_KEY=your_aws_secret_key
export AWS_BUCKET_NAME=your-aws-bucket-name
export AWS_REGION=your-aws-bucket-region

export AZURE_CONNECTION_STRING=your_azure_connection_string
export AZURE_CONTAINER_NAME=your-azure-container-name

export GCP_CREDENTIALS_PATH=your-credentials-path #e.g. /home/user/gcp-credentials.json
export GCP_BUCKET_NAME=your-gcp-bucket-name
```

### 4ï¸âƒ£ Run the CLI

```bash
java -jar target/database-backup-utility.jar
```

---

## ğŸ’¬ Spring Shell CLI

When the app starts, youâ€™ll see a prompt like this:

```
dbu:>_
```

Type `help` to view all available commands.

---

## ğŸ§­ Usage Guide

### ğŸ”Œ 1. Connect to a Database

```bash
connect --database-type <TYPE> --host <HOST> --port <PORT> --database <DB_NAME> --user <USER> --password <PASSWORD>
```

**Example:**
```bash
dbu:> connect --database-type MYSQL --host localhost --port 3306 --database sales --user root --password pass123
```
âœ… Output:
```
Successfully connected to database: sales [MYSQL] 
```

---

### ğŸ’¾ 2. Backup a Database

```bash
backup --database-type <TYPE> --host <HOST> --port <PORT> --database <DB_NAME> --user <USER> --password <PASSWORD> --output <OUTPUT_PATH> --compress <TYPE> --cron <CRON_EXPRESSION>
```

**Example 1: âš¡ Immediate Backup**
```bash
dbu:> backup --database-type POSTGRESQL --database mydb --user admin --password pass123 --output ./backups --compress GZIP
```
âœ… Output:
```
Database backup completed successfully: ./backups/backup_mydb_2025-10-23.gzip
```

**Example 2: â° Scheduled Backup**
```bash
dbu:> backup --database-type MYSQL --database sales --user root --password 12345 --output ./backups --compress ZIP --cron "0 0 3 * * ?"
```
âœ… Output:
```
Backup schedule created successfully. The database will be backed up according to the cron schedule: 0 0 3 * * ?
```

---

### ğŸ” 3. Restore a Database

```bash
restore --database-type <TYPE> --database <DB_NAME> --user <USER> --password <PASSWORD> --input-path <BACKUP_FILE_PATH>
```

**Example:**
```bash
dbu:> restore --database-type POSTGRESQL --database mydb --user admin --password pass123 --input-path ./backups/backup_mydb_2025-10-22.zip
```
âœ… Output:
```
Database restore successful.
```

---

### â˜ï¸ 4. Cloud Storage Commands

**â¬†ï¸ Upload a Backup File**
```bash
upload --storage-type <TYPE> --key <REMOTE_PATH> --file-path <LOCAL_FILE>
```

**Example:**
```bash
dbu:> upload --storage-type AWS --key backups/mydb_2025-10-23.gzip --file-path ./backups/backup_mydb_2025-10-23.gzip
```
âœ… Output:
```
Upload successful! URL: https://s3.amazonaws.com/mybucket/backups/mydb_2025-10-23.gzip
```

**â¬‡ï¸ Download a File**
```bash
download --storage-type <TYPE> --key <REMOTE_PATH> --destination <LOCAL_DIR>
```

**Example:**
```bash
dbu:> download --storage-type GCP --key backups/sales_2025-10-20.zip --destination ./downloads
```
âœ… Output:
```
Download successful! Saved to: ./downloads/sales_2025-10-20.zip
```

**ğŸ—‘ï¸ Delete a File**
```bash
delete --storage-type <TYPE> --key <REMOTE_PATH>
```

**Example:**
```bash
dbu:> delete --storage-type GCP --key backups/sales_2025-10-20.zip 
```
âœ… Output:
```
File deleted successfully.
```

**ğŸ“œ List All Files**
```bash
list --storage-type <TYPE>
```

**Example:**
```bash
dbu:> list --storage-type GCP 
```
âœ… Output:
```
File Name                                Size           Last Modified       
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
backups/sales_2025-10-20.zip             15 MB          2025-10-20 16:17:04 
backups/sales_2025-10-22.zip             40 MB          2025-10-22 16:26:36 
backups/sales_2025-10-24.zip             60 MB          2025-10-24 16:26:36 
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total: 3 file(s)
```

**Check if a File Exists**
```bash
check --storage-type <TYPE> --key <REMOTE_PATH>
```

**Example:**
```bash
dbu:> check --storage-type AWS --key backups/mydb_2025-10-23.gzip
```
âœ… Output:
```
File exists: true
```

---

## ğŸ§© Example Workflow

```bash
# 1. Connect
dbu:> connect --database-type POSTGRESQL --database mydb --user admin --password 1234

# 2. Backup & Compress
dbu:> backup --database-type POSTGRESQL --database mydb --user admin --password 1234 --output ./backups --compress ZIP

# 3. Upload to S3
dbu:> upload --storage-type AWS --key backups/mydb_latest.zip --file-path ./backups/backup_mydb_latest.zip

# 4. Schedule daily backups at 2 AM
dbu:> backup --database-type POSTGRESQL --database mydb --user admin --password 1234 --output ./backups --cron "0 0 2 * * ?"
```

---

## ğŸ—œï¸ Compression Options

| Type | Extension | Description |
|-------|------------|-------------|
| **NONE** | (no compression) | Raw dump file |
| **ZIP** | `.zip` | Standard compression |
| **GZIP** | `.gzip` | Fast single-file compression |
| **TARGZ** | `.tar.gz` | Common on Linux/Unix |

---

## â° Scheduling with Quartz 

Automate periodic backups using cron expressions.  
Example:
```bash
dbu:> backup --database-type POSTGRESQL --database mydb --user admin --password pass123 --output ./backups --cron "0 0 3 * * ?"
```

âœ… Output:
```
Backup schedule created successfully. The database will be backed up according to the cron schedule: *0 0 3 * * ?*.
```

---

## ğŸ—“ï¸ Managing Backup Schedulers

After creating backup schedules, you can manage and monitor them directly using the available shell commands provided by `SchedulerCommand`.

### ğŸ” View all schedulers
List all existing backup jobs along with their current state, next, and previous execution times.

```bash
dbu:> list-schedulers
```

âœ… Output:
```
LIST OF BACKUP JOBS:
================================================================================
JOB NAME                       GROUP        STATE        NEXT FIRE               PREVIOUS FIRE
--------------------------------------------------------------------------------
dailyBackup                    MYSQL        NORMAL       2025-10-28T03:00:00     2025-10-27T03:00:00
================================================================================
```

**ğŸ“ Note - Quartz Job States & Groups:**

**Job States**

In Quartz Scheduler, each **Trigger** (and its associated Job) can have one of the following states

- ğŸŸ¢ NORMAL â†’ Scheduled jobs are running as planned.
- ğŸŸ¡ PAUSED â†’ Temporarily stopped; can resume later.
- ğŸ”µ COMPLETE â†’ Finished; may need to reschedule for future runs.
- ğŸ”´ ERROR â†’ Check logs to diagnose the failure.
- ğŸŸ£ BLOCKED â†’ Job is currently running; concurrent execution is not allowed.

**Job Groups**

Backup jobs are organized into **Groups** according to the type of database:

| Group Name   | Database Type | Description                               |
|-------------|---------------|-------------------------------------------|
| `POSTGRESQL` | PostgreSQL    | Jobs that back up PostgreSQL databases    |
| `MYSQL`      | MySQL         | Jobs that back up MySQL databases         |
| `MONGODB`    | MongoDB       | Jobs that back up MongoDB databases       |

**ğŸ’¡ Tip:**  
- Use **Group names** to filter jobs when pausing, resuming, or deleting specific database backups.  
- Pay attention to **Job States** to understand whether a job is active, paused, completed, or encountering errors.

### â¸ï¸ Pause a specific scheduler
Temporarily pause a scheduled backup job.
```bash
dbu:> pause-scheduler -j dailyBackup -g BACKUP
```

âœ… Output:
```
Paused job: dailyBackup (BACKUP)
```

### â–¶ï¸ Resume a paused scheduler
Resume a job that was previously paused.
```bash
dbu:> resume-scheduler -j dailyBackup -g BACKUP
```

âœ… Output:
```
Resumed job: dailyBackup (BACKUP)
```

### ğŸ—‘ï¸ Delete a scheduler
Completely remove a backup job from the scheduler.
```bash
dbu:> delete-scheduler -j dailyBackup -g BACKUP
```

âœ… Output:
```
Deleted job: dailyBackup (BACKUP)
```

### â¹ï¸ Pause all schedulers
Pause all running backup jobs at once.
```bash
dbu:> pause-all
```

âœ… Output:
```
Paused all backup jobs.
```

### ğŸ” Resume all schedulers
Resume all paused backup jobs.
```bash
dbu:> resume-all
```

âœ… Output:
```
Resumed all backup jobs.
```

 ---

